# Django Shop - Интернет-магазин

Проект интернет-магазина на Django с использованием Django ORM и современного стека технологий.

## Описание проекта

Этот проект представляет собой полноценную реализацию интернет-магазина с использованием Django и Django ORM. 
Проект включает в себя все необходимые компоненты для работы онлайн-магазина: каталог товаров, систему заказов, 
управление пользователями и административную панель.

## Основные возможности

- Каталог товаров с категориями
- Система управления заказами
- Административная панель для управления контентом
- Система регистрации и авторизации пользователей
- Управление товарами и категориями
- Система обработки заказов
- Поддержка медиафайлов (изображения товаров и категорий)

## Технический стек

- Python 3.11
- Django 5.2.1
- SQLite (для разработки)
- Pillow (для работы с изображениями)
- Django Admin (для управления контентом)

## Структура проекта

```
django_shop/
├── catalog/                 # Основное приложение магазина
│   ├── management/         # Пользовательские команды
│   ├── migrations/         # Миграции базы данных
│   ├── admin.py           # Конфигурация админ-панели
│   ├── apps.py            # Конфигурация приложения
│   ├── models.py          # Модели данных
│   ├── tests.py           # Тесты
│   └── views.py           # Представления
├── shop/                   # Основной проект
│   ├── settings.py        # Настройки проекта
│   ├── urls.py            # URL-маршруты
│   ├── wsgi.py            # WSGI конфигурация
│   └── asgi.py            # ASGI конфигурация
├── media/                  # Медиафайлы (изображения)
├── static/                 # Статические файлы
├── venv/                   # Виртуальное окружение
├── manage.py              # Скрипт управления Django
└── db.sqlite3             # База данных SQLite
```

## Структура моделей

### 1. Category (Категории товаров)
- `name` - название категории
- `slug` - URL-совместимый идентификатор
- `description` - описание категории
- `image` - изображение категории

### 2. Product (Товары)
- `category` - связь с категорией (ForeignKey)
- `name` - название товара
- `slug` - URL-совместимый идентификатор
- `image` - изображение товара
- `description` - описание товара
- `price` - цена
- `stock` - количество на складе
- `available` - доступность товара
- `created` - дата создания
- `updated` - дата обновления

### 3. Customer (Покупатели)
- `first_name` - имя
- `last_name` - фамилия
- `email` - электронная почта
- `phone` - телефон
- `address` - адрес
- `created` - дата создания

### 4. Order (Заказы)
- `customer` - связь с покупателем (ForeignKey)
- `created` - дата создания
- `updated` - дата обновления
- `status` - статус заказа
- `note` - примечание к заказу

### 5. OrderItem (Элементы заказа)
- `order` - связь с заказом (ForeignKey)
- `product` - связь с товаром (ForeignKey)
- `price` - цена на момент заказа
- `quantity` - количество

## Работа с пользователями

- В проекте используется расширенная (кастомная) модель пользователя `CustomUser` (наследуется от `AbstractUser`).
- Для управления пользователями создано отдельное приложение `users`.
- Реализованы регистрация, вход, выход и личный кабинет пользователя.
- При регистрации автоматически создаётся связанная запись `Customer` (через OneToOneField), что позволяет хранить дополнительную информацию о покупателе.
- Для доступа к личному кабинету требуется авторизация (используется декоратор `login_required`).
- В админке можно видеть связь между пользователем и покупателем.

### Основные маршруты пользователей

- `/users/register/` — регистрация
- `/users/login/` — вход
- `/users/logout/` — выход
- `/users/profile/` — личный кабинет (только для авторизованных)

### Обновлённая модель Customer

- `user` — связь с пользователем (OneToOneField, может быть null для старых данных)
- `first_name`, `last_name`, `email`, `phone`, `address`, `created` — как раньше

## Установка и запуск

1. Клонировать репозиторий:
   ```bash
   git clone <url-репозитория>
   cd django_shop
   ```

2. Создать и активировать виртуальное окружение:
   ```bash
   python -m venv venv
   # Для Windows:
   venv\Scripts\activate
   # Для Linux/Mac:
   source venv/bin/activate
   ```

3. Установить зависимости:
   ```bash
   pip install django pillow
   ```

4. Применить миграции:
   ```bash
   python manage.py migrate
   ```

5. Создать суперпользователя:
   ```bash
   python manage.py shell
   ```

6. Заполнить базу тестовыми данными:
   ```bash
   python manage.py fill_db
   ```

7. Запустить сервер разработки:
   ```bash
   python manage.py runserver
   ```

8. Открыть в браузере:
   - Сайт: http://127.0.0.1:8000/
   - Админ-панель: http://127.0.0.1:8000/admin/

## Особенности проекта

- Локализация на русский язык
- Часовой пояс: Europe/Moscow
- Поддержка медиафайлов (изображения товаров и категорий)
- Автоматическое создание slug-полей для URL
- Система управления заказами с различными статусами
- Команда для заполнения базы тестовыми данными
- Кастомная модель пользователя (готова к расширению)
- Регистрация, вход, выход, личный кабинет
- Связь между пользователем и покупателем (Customer)

## Безопасность

- В режиме разработки используется SQLite
- Для продакшена необходимо:
  - Изменить SECRET_KEY
  - Отключить DEBUG
  - Настроить ALLOWED_HOSTS
  - Использовать более надежную БД (PostgreSQL)
  - Настроить HTTPS
  - Настроить статические файлы через веб-сервер

## Лицензия

MIT License

## Изменения (Новая ветка "refactor-views-and-models")

В новой ветке "refactor-views-and-models" внесены следующие улучшения:

- Переписаны представления (views) на CBV (Class-Based Views) для списка категорий, деталей категории, списка товаров, деталей товара и поиска товаров.
- Вынесены общие поля (name, slug, description, image) в абстрактную модель (BaseCatalogItem), от которой наследуются модели Category и Product.
- Реализована новая страница поиска товаров (поиск по названию и описанию) с шаблоном (catalog/templates/catalog/product_search.html) и ссылкой на поиск в базовом шаблоне.
- Исправлены (и автоматизированы) пустые slug'и (с помощью команды "fix_slugs") для категорий и товаров (в том числе, исправлена команда, чтобы генерировать уникальные slug'и).
- Обновлены маршруты (urls) (например, добавлен маршрут для корневого пути, чтобы при переходе на "/" пользователь перенаправлялся на список категорий).
- Обновлены шаблоны (например, добавлена проверка на наличие slug'а в шаблоне списка категорий, а также создан шаблон (catalog/templates/catalog/category_detail.html) для детальной страницы категории).
- Добавлена пагинация (например, по 10 товаров на страницу) для списков товаров и категорий (если реализовано).

## Дальнейшие улучшения (Планируемые улучшения)

В будущем планируется (или уже реализовано) добавить (или улучшить) следующие функции:

- Пагинация (например, по 10 товаров на страницу) для списков товаров и категорий (если ещё не реализовано).
- Детальная страница товара (например, по адресу /catalog/product/<int:pk>/<slug:slug>/).
- Фильтрация и сортировка (например, фильтр по цене, сортировка по имени, цене, дате и т.д.).
- Настройка админки (например, кастомные действия, улучшенное отображение списков, поиск и фильтры).
- Добавление тестов (например, unit-тесты для моделей, представлений, команд).
- Улучшение стилей (CSS) (например, адаптивная верстка, улучшение внешнего вида списков, форм, детальных страниц).
- Функционал корзины (или заказов) (например, страница корзины, оформление заказа, управление заказами).
- Настройка CI/CD (например, автоматизация тестирования, сборки и деплоя проекта).

## REST API

В проекте реализован REST API для работы с основными сущностями (категории, товары, покупатели, заказы, элементы заказа) с помощью Django REST Framework.

- Базовый путь для API: `/api/`
- Примеры эндпоинтов:
  - `/api/categories/` — список и создание категорий
  - `/api/products/` — список и создание товаров
  - `/api/customers/` — список и создание покупателей
  - `/api/orders/` — список и создание заказов
  - `/api/orderitems/` — элементы заказа

### Аутентификация и права доступа

- Для доступа к защищённым эндпоинтам используется токен-аутентификация (DRF TokenAuthentication).
- Получить токен можно по эндпоинту `/users/api-token-auth/` (POST: username, password).
- Обновить токен — `/users/api-token-refresh/` (POST, с действующим токеном в заголовке).
- Для доступа к большинству API требуется авторизация. Создавать/изменять категории и товары может только администратор.
- Обычные пользователи могут просматривать публичные данные и работать со своими заказами.

### Пример запроса на получение токена
```bash
curl -X POST -d "username=admin&password=adminpass" http://127.0.0.1:8000/users/api-token-auth/
```

### Пример запроса с токеном
```bash
curl -H "Authorization: Token <ваш_токен>" http://127.0.0.1:8000/api/orders/
```

## Тестирование

В проекте реализованы автоматические тесты для проверки:
- регистрации, входа, выхода, профиля пользователя
- работы прав доступа (permissions)
- работы API (аутентификация, доступ, CRUD)

### Запуск всех тестов
```bash
python manage.py test -v 2
```

### Запуск только тестов API аутентификации
```bash
python manage.py test users.tests.APIAuthenticationTest -v 2
```

## Инструкции по запуску и тестированию

### Запуск проекта

1. Убедитесь, что у вас активировано виртуальное окружение (например, venv).  
  (Например, в Windows:  
    venv\Scripts\activate  
  или в Linux/Mac:  
    source venv/bin/activate.)

2. Запустите сервер (например, выполнив команду):  
  python manage.py runserver  
  (по умолчанию проект будет доступен по адресу http://127.0.0.1:8000/).

### Тестирование и работа с новой веткой

- **Переключение на новую ветку:**  
  git checkout refactor-views-and-models

- **Запуск команды для исправления slug'ов (если необходимо):**  
  python manage.py fix_slugs

- **Тестирование страниц:**  
  – Список категорий: http://127.0.0.1:8000/catalog/categories/  
  – Список товаров: http://127.0.0.1:8000/catalog/products/  
  – Поиск товаров: http://127.0.0.1:8000/catalog/search/?q=телефон  
  – Детальная страница товара (если реализована): /catalog/product/<int:pk>/<slug:slug>/

- **Дополнительно:**  
  – Если вы хотите заполнить базу тестовыми данными, можно воспользоваться командой (например, если у вас есть команда fill_db):  
    python manage.py fill_db  
  или вручную добавить данные через админку.


